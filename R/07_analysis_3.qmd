---
title: "07_analysis_3"
format: html
---

# Load libraries and data

```{r}
#| warning: false
library(tidyverse)
library(readr)
```

```{r}
#| message: false
aug_data <- read_tsv("../data/03_dat_aug.tsv")
```

# Analysis

```{r}
top_12 <- aug_data |> 
  count(patient_number, sort = TRUE) |> 
  head(12)
```

```{r fmax_over_time}
#| label: fmax_over_time

aug_data |> 
  filter(patient_number %in% top_12$patient_number) |> 
    ggplot(aes(x = days_from_baseline, 
               y = fmax_mean)) +
  geom_point(aes(color = saa_custom,
                 shape = as.factor(project))) +
  geom_line(color = "gray") +
  facet_wrap(~ patient_number) +
  theme_minimal() +
  scale_x_continuous(n.breaks = 3) +
  labs(title = "Mean fmax over time for the 12 patients with the most visits",
       x = "Days from baseline",
       y = "Mean fmax (RFU)",
       shape = "Project",
       color = "SAA status")
ggsave(filename = "../results/07_fmax_over_time.png")

  
```

```{r}
aug_data |> 
    ggplot(aes(x = days_from_baseline, 
               y = fmax_mean)) +
  geom_point(aes(color = saa_custom,
                 shape = as.factor(project))) +
  labs(title = "Mean fmax over time",
       x = "Days from baseline",
       y = "Mean fmax (RFU)",
       shape = "Project",
       color = "SAA status") +
  theme_minimal() 
```

